<!DOCTYPE html>
<html>

<head>
	<title>Change Password</title>
</head>

<body>

	<legend><b>CHANGE PASSWORD</b></legend>
	<form action="" method="post">
		<table>
			<tr>
				<td>
					<font size="3">Current Password</font>
				</td>
				<td>:</td>
				<td><input type="password" name="current_password" /></td>
				<td></td>
			</tr>
			<tr>
				<td>
					<font size="3" color="green">New Password</font>
				</td>
				<td>:</td>
				<td><input type="password" name="new_password" /></td>
				<td></td>
			</tr>
			<tr>
				<td>
					<font size="3" color="red">Retype New Password</font>
				</td>
				<td>:</td>
				<td><input type="password" name="retype_new_password" /></td>
				<td></td>
			</tr>
		</table>
		<hr />
		<input type="submit" value="Submit" />
	</form>
	</fieldset>
	<?php
    session_start();
    if (isset($_SESSION['flag'])) {
        if ($_SERVER["REQUEST_METHOD"] == "POST") {
            $currentPassword = $_POST['current_password'];
            $newPassword = $_POST['new_password'];
            $retypeNewPassword = $_POST['retype_new_password'];

   
            $passwordRegex = '/^(?=.*[@#$%]).{8,}$/';

            if (strlen($newPassword) < 8 || !preg_match($passwordRegex, $newPassword)) {
                echo "Invalid New Password. Please enter a valid password.";
            } elseif ($newPassword !== $retypeNewPassword) {
                echo "New Password and Retyped Password did not match. Please try again.";
            } elseif ($currentPassword === $newPassword) {
                echo "New Password should not be the same as the Current Password. Please choose a different password.";
            } else {

                echo "Password change successful!";
            }
        }
    ?>
</body>

</html>